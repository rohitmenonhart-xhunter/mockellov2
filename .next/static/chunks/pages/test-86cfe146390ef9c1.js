(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[378],{1185:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test",function(){return r(8638)}])},8638:function(e,t,r){"use strict";r.r(t),r.d(t,{TestInner:function(){return ed},default:function(){return ei}});var s=r(5893),a=r(1249),l=r(3826),o=r(3114),n=r(7353),i=r(9008),c=r.n(i),d=r(7294),m=r(1163),u=r(1019);let g=(0,r(3977).ZF)({apiKey:"AIzaSyCuWTdQuHs_l6rvfzaxvY4y-Uzn0EARRwM",authDomain:"athentication-3c73e.firebaseapp.com",databaseURL:"https://athentication-3c73e-default-rtdb.firebaseio.com",projectId:"athentication-3c73e",storageBucket:"athentication-3c73e.firebasestorage.app",messagingSenderId:"218346867452",appId:"1:218346867452:web:58a57b37f6b6a42ec72579",measurementId:"G-3GBM5TSMLS"}),p=(0,u.N8)(g),h=e=>{let{diameter:t=20,strokeWidth:r=4}=e;return(0,s.jsxs)("svg",{className:"animate-spin",fill:"none",viewBox:"0 0 24 24",style:{width:"".concat(t,"px"),height:"".concat(t,"px")},children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:r}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})};var x=r(5591);let f=e=>{let{accentColor:t,children:r,className:a="",disabled:l,...o}=e;return d.useEffect(()=>{document.documentElement.style.setProperty("--theme-color",t),document.documentElement.style.setProperty("--theme-hover","".concat(t,"1A")),document.documentElement.style.setProperty("--theme-border","".concat(t,"33")),document.documentElement.style.setProperty("--theme-shadow","".concat(t,"4D"))},[t]),(0,s.jsx)("button",{className:"theme-button px-3 py-1 rounded-md ".concat(a),disabled:l,...o,children:r})},b=[{id:"fullstack",label:"Full Stack Developer"},{id:"devops",label:"DevOps Engineer"},{id:"frontend",label:"Frontend Developer"},{id:"backend",label:"Backend Developer"},{id:"software",label:"Software Engineer"},{id:"data",label:"Data Engineer"},{id:"ml",label:"Machine Learning Engineer"},{id:"cloud",label:"Cloud Engineer"},{id:"sysadmin",label:"System Administrator"},{id:"qa",label:"QA Engineer"},{id:"electronics",label:"Electronics Engineer"},{id:"electrical",label:"Electrical Engineer"},{id:"mechanical",label:"Mechanical Engineer"},{id:"civil",label:"Civil Engineer"},{id:"product",label:"Product Manager"},{id:"project",label:"Project Manager"},{id:"uiux",label:"UI/UX Designer"},{id:"dba",label:"Database Administrator"},{id:"security",label:"Security Engineer"},{id:"network",label:"Network Engineer"}],v=e=>{let{selectedRole:t,setSelectedRole:r}=e;return(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-sm text-gray-400 text-left",children:"Select Your Role:"}),(0,s.jsxs)("select",{value:t,onChange:e=>r(e.target.value),className:"text-white text-sm bg-gray-900 border border-gray-800 rounded-sm px-3 py-2 focus:border-[#BE185D] focus:outline-none",children:[(0,s.jsx)("option",{value:"",children:"Select a role..."}),b.map(e=>(0,s.jsx)("option",{value:e.id,children:e.label},e.id))]})]})},y=e=>{let{accentColor:t,onConnectClicked:r}=e,[a,l]=(0,d.useState)("");return(0,s.jsx)("div",{className:"flex left-0 top-0 w-full h-full bg-black/80 items-center justify-center text-center gap-2",children:(0,s.jsx)("div",{className:"min-h-[540px]",children:(0,s.jsxs)("div",{className:"flex flex-col bg-gray-950 w-full max-w-[480px] rounded-lg text-white border border-gray-900",children:[(0,s.jsx)("div",{className:"flex flex-col gap-2",children:(0,s.jsxs)("div",{className:"px-10 space-y-2 py-6",children:[(0,s.jsx)("h1",{className:"text-2xl",children:"Connect to Interview"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Select your role and connect to begin your interview"})]})}),(0,s.jsx)("div",{className:"flex flex-col bg-gray-900/30 flex-grow p-8",children:(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsx)(v,{selectedRole:a,setSelectedRole:l}),(0,s.jsx)(f,{accentColor:t,className:"w-full",disabled:!a,onClick:()=>{a&&(localStorage.setItem("interviewRole",a),r("env"))},children:a?"Start Interview":"Please select a role"})]})})]})})})},w=e=>{let{colors:t,selectedColor:r,onSelect:a}=e,[l,o]=(0,d.useState)(!1);return(0,s.jsx)("div",{className:"flex flex-row gap-1 py-2 flex-wrap",onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:t.map(e=>{let t=e===r;return(0,s.jsx)("div",{className:"rounded-md p-1 border-2 cursor-pointer transition-all duration-200 hover:scale-105",style:{borderColor:t?"#1F2937":"transparent",opacity:l||t?1:.2,filter:l||t?"none":"saturate(0.25)"},onClick:()=>a(e),children:(0,s.jsx)("div",{className:"w-5 h-5 rounded-sm",style:{backgroundColor:e}})},e)})})},j=e=>{let{trackRef:t}=e;return(0,s.jsx)("div",{className:"flex flex-row gap-2 h-[100px] items-center w-full justify-center border rounded-sm border-gray-800 bg-gray-900",children:(0,s.jsx)(l.B,{trackRef:t,className:"h-full w-full",barCount:20,options:{minHeight:0}})})};var k=r(3667);let N=e=>{let{kind:t}=e,[r,a]=(0,d.useState)(!1),l=(0,k.e)({kind:t}),[o,n]=(0,d.useState)("");return(0,d.useEffect)(()=>{l.devices.forEach(e=>{e.deviceId===l.activeDeviceId&&n(e.label)})},[l.activeDeviceId,l.devices,o]),(0,d.useEffect)(()=>{let e=e=>{r&&a(!1)};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[r]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("button",{className:"flex gap-2 items-center px-2 py-1 bg-gray-900 text-gray-300 border border-gray-800 rounded-sm hover:bg-gray-800",onClick:e=>{a(!r),e.stopPropagation()},children:[(0,s.jsx)("span",{className:"max-w-[80px] overflow-ellipsis overflow-hidden whitespace-nowrap",children:o}),(0,s.jsx)(S,{})]}),(0,s.jsx)("div",{className:"absolute right-4 top-12 bg-gray-800 text-gray-300 border border-gray-800 rounded-sm z-10",style:{display:r?"block":"none"},children:l.devices.map((e,t)=>(0,s.jsx)("div",{onClick:()=>{l.setActiveMediaDevice(e.deviceId),a(!1)},className:"".concat(e.deviceId===l.activeDeviceId?"text-white":"text-gray-500"," bg-gray-900 text-xs py-2 px-2 cursor-pointer hover:bg-gray-800 hover:text-white"),children:e.label},t))})]})},S=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3 5H5V7H3V5ZM7 9V7H5V9H7ZM9 9V11H7V9H9ZM11 7V9H9V7H11ZM11 7V5H13V7H11Z",fill:"currentColor",fillOpacity:"0.8"})}),C=e=>{let{children:t,title:r,deviceSelectorKind:a}=e;return(0,s.jsxs)("div",{className:"w-full text-gray-300 py-4 border-b border-b-gray-800 relative",children:[(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center px-4 text-xs uppercase tracking-wider",children:[(0,s.jsx)("h3",{children:r}),a&&(0,s.jsxs)("span",{className:"flex flex-row gap-2",children:[(0,s.jsx)(l.T,{className:"px-2 py-1 bg-gray-900 text-gray-300 border border-gray-800 rounded-sm hover:bg-gray-800",source:"audioinput"===a?x.fQ.Source.Microphone:x.fQ.Source.Camera}),(0,s.jsx)(N,{kind:a})]})]}),(0,s.jsx)("div",{className:"px-4 py-2 text-xs text-gray-500 leading-normal",children:t})]})},E=e=>{let{name:t,value:r,valueColor:a}=e;return(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-500",children:t}),(0,s.jsx)("span",{style:{color:a},children:r})]})};var I=r(4498);let _=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",children:[(0,s.jsx)("g",{clipPath:"url(#clip0_718_9977)",children:(0,s.jsx)("path",{d:"M1.5 7.5L4.64706 10L10.5 2",stroke:"white",strokeWidth:"1.5",strokeLinecap:"square"})}),(0,s.jsx)("defs",{children:(0,s.jsx)("clipPath",{id:"clip0_718_9977",children:(0,s.jsx)("rect",{width:"12",height:"12",fill:"white"})})})]}),R=()=>(0,s.jsx)("svg",{width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"fill-gray-200 transition-all group-hover:fill-white group-data-[state=open]:rotate-180",children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"m8 10.7.4-.3 4-4 .3-.4-.7-.7-.4.3L8 9.3 4.4 5.6 4 5.3l-.7.7.3.4 4 4 .4.3Z"})});var D=r(7041),T=r(1272),P=r(9332);let M={title:"MOCKELLO HR ROUND TRAINER",description:"",video_fit:"cover",settings:{editable:!0,theme_color:"cyan",chat:!0,inputs:{camera:!0,mic:!0},outputs:{audio:!0,video:!0},ws_url:"",token:""},show_qr:!1},L=()=>(0,d.useMemo)(()=>{try{let e=T.ZP.load("\ntitle: 'MOCKELLO'\ndescription: ''\nvideo_fit: 'cover' # 'contain' or 'cover'\nsettings:\n  editable: false # Should the user be able to edit settings in-app\n  theme_color: 'pink'\n  chat: true  # Enable or disable chat feature\n  outputs:\n    audio: true # Enable or disable audio output\n    video: false # Enable or disable video output\n  inputs:\n    mic: true    # Enable or disable microphone input\n    camera: true # Enable or disable camera input\n    sip: false    # Enable or disable SIP input\n");return void 0===e.settings&&(e.settings=M.settings),void 0===e.settings.editable&&(e.settings.editable=!0),e}catch(e){console.error("Error parsing app config:",e)}return M},[]),O=(0,d.createContext)(void 0),F=e=>{let{children:t}=e,r=L(),a=(0,P.useRouter)(),[l,o]=(0,d.useState)(null),n=(0,d.useCallback)(()=>{if(!window.location.hash||!1===r.settings.editable)return null;let e=new URLSearchParams(window.location.hash.replace("#",""));return{editable:!0,chat:"1"===e.get("transcription"),theme_color:e.get("theme_color"),inputs:{camera:"1"===e.get("cam"),mic:"1"===e.get("mic")},outputs:{audio:"1"===e.get("audio"),video:"1"===e.get("video"),chat:"1"===e.get("chat")},ws_url:"",token:""}},[r]),i=(0,d.useCallback)(()=>{if(!1===r.settings.editable)return null;let e=(0,D.getCookie)("lk_settings");return e?JSON.parse(e):null},[r]),c=(0,d.useCallback)(e=>{let t=new URLSearchParams({cam:B(e.inputs.camera),mic:B(e.inputs.mic),video:B(e.outputs.video),audio:B(e.outputs.audio),chat:B(e.chat),theme_color:e.theme_color||"cyan"});a.replace("/#"+t.toString())},[a]),m=(0,d.useCallback)(e=>{let t=JSON.stringify(e);(0,D.setCookie)("lk_settings",t)},[]),u=(0,d.useCallback)(()=>{if(!1===r.settings.editable)return l&&(r.settings.theme_color=l),r;let e=i(),t=n();!e&&t&&m(t),!t&&e&&c(e);let s=i();return s?(r.settings=s,{...r}):r},[r,i,n,l,m,c]),g=(0,d.useCallback)(e=>{if(!1===r.settings.editable){o(e.theme_color);return}c(e),m(e),h(t=>({...t,settings:e}))},[r,m,c]),[p,h]=(0,d.useState)(u());return(0,d.useEffect)(()=>{h(u())},[u]),(0,s.jsx)(O.Provider,{value:{config:p,setUserSettings:g},children:t})},A=()=>{let e=d.useContext(O);if(void 0===e)throw Error("useConfig must be used within a ConfigProvider");return e},B=e=>e?"1":"0",U=[{title:"Show chat",type:"chat",key:"N/A"},{title:"---",type:"separator",key:"separator_1"},{title:"Show video",type:"outputs",key:"video"},{title:"Show audio",type:"outputs",key:"audio"},{title:"---",type:"separator",key:"separator_2"},{title:"Enable camera",type:"inputs",key:"camera"},{title:"Enable mic",type:"inputs",key:"mic"}],H=()=>{let{config:e,setUserSettings:t}=A(),r=t=>{if("separator"===t.type||"theme_color"===t.type)return!1;if("chat"===t.type)return e.settings[t.type];if("inputs"===t.type){let r=t.key;return e.settings.inputs[r]}if("outputs"===t.type){let r=t.key;return e.settings.outputs[r]}return!1},a=s=>{if("separator"===s.type||"theme_color"===s.type)return;let a=!r(s),l={...e.settings};"chat"===s.type?l.chat=a:"inputs"===s.type?l.inputs[s.key]=a:"outputs"===s.type&&(l.outputs[s.key]=a),t(l)};return(0,s.jsxs)(I.fC,{modal:!1,children:[(0,s.jsx)(I.xz,{className:"group inline-flex max-h-12 items-center gap-1 rounded-md hover:bg-gray-800 bg-gray-900 border-gray-800 p-1 pr-2 text-gray-100",children:(0,s.jsxs)("button",{className:"my-auto text-sm flex gap-1 pl-2 py-1 h-full items-center",children:["Settings",(0,s.jsx)(R,{})]})}),(0,s.jsx)(I.Uv,{children:(0,s.jsx)(I.VY,{className:"z-50 flex w-60 flex-col gap-0 overflow-hidden rounded text-gray-100 border border-gray-800 bg-gray-900 py-2 text-sm",sideOffset:5,collisionPadding:16,children:U.map(e=>"separator"===e.type?(0,s.jsx)("div",{className:"border-t border-gray-800 my-2"},e.key):(0,s.jsxs)(I.__,{onClick:()=>a(e),className:"flex max-w-full flex-row items-end gap-2 px-3 py-2 text-xs hover:bg-gray-800 cursor-pointer",children:[(0,s.jsx)("div",{className:"w-4 h-4 flex items-center",children:r(e)&&(0,s.jsx)(_,{})}),(0,s.jsx)("span",{children:e.title})]},e.key))})})]})},z=[{id:"fullstack",label:"Room 001"},{id:"devops",label:"Room 002"},{id:"frontend",label:"Room 003"},{id:"backend",label:"Room 004"},{id:"software",label:"Room 005"},{id:"data",label:"Room 006"},{id:"ml",label:"Room 007"},{id:"cloud",label:"Room 008"},{id:"sysadmin",label:"Room 009"},{id:"qa",label:"Room 010"},{id:"electronics",label:"Room 011"},{id:"electrical",label:"Room 012"},{id:"mechanical",label:"Room 013"},{id:"civil",label:"Room 014"},{id:"product",label:"Room 015"},{id:"project",label:"Room 016"},{id:"uiux",label:"Room 017"},{id:"dba",label:"Room 018"},{id:"security",label:"Room 019"},{id:"network",label:"Room 020"}],J=e=>{let{logo:t,title:r,githubLink:a,accentColor:l,height:o,onConnectClicked:n,connectionState:i,timeLeft:c=0}=e,{config:m}=A(),[u,g]=(0,d.useState)(""),[p,b]=(0,d.useState)(!1),v=()=>i===x.em.Connecting?(0,s.jsx)(h,{}):i===x.em.Connected?"Note: session closing soon":u?"Connect":"Select Role",y=i===x.em.Connecting,w=i===x.em.Connected,j=i===x.em.Disconnected,k=j&&!p||w&&c<=300;return(0,d.useEffect)(()=>{if(k&&w&&c<=300){console.log("Generate Feedback button appeared, auto-clicking in 15 seconds");let e=setTimeout(()=>{console.log("Auto-clicking Generate Feedback button"),n()},15e3);return()=>clearTimeout(e)}},[k,w,c,n]),(0,d.useEffect)(()=>{j&&b(!1)},[j]),(0,s.jsxs)("div",{className:"flex gap-4 pt-4 text-".concat(l,"-500 justify-between items-center shrink-0"),style:{height:o+"px"},children:[(0,s.jsx)("div",{className:"flex items-center gap-3 basis-2/3",children:(0,s.jsx)("div",{className:"lg:basis-1/2 lg:text-center text-xs lg:text-base lg:font-semibold text-white",children:r})}),(0,s.jsxs)("div",{className:"flex basis-1/3 justify-end items-center gap-4",children:[m.settings.editable&&(0,s.jsx)(H,{}),k&&j&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("select",{value:u,onChange:e=>g(e.target.value),className:"text-white text-sm bg-gray-900 border border-gray-800 rounded-sm px-3 py-2 focus:border-[#BE185D] focus:outline-none",disabled:y||p,children:[(0,s.jsx)("option",{value:"",children:"Select Role"}),z.map(e=>(0,s.jsx)("option",{value:e.id,children:e.label},e.id))]}),(0,s.jsx)(f,{accentColor:l,disabled:y||!u||p,onClick:()=>{u&&!p&&(localStorage.setItem("interviewRole",u),b(!0),n())},children:v()})]}),k&&w&&(0,s.jsx)(f,{accentColor:"red",onClick:n,children:v()})]})]})},V=e=>{let{onSubmit:t}=e,[r,a]=(0,d.useState)(""),[l,o]=(0,d.useState)(""),[n,i]=(0,d.useState)("");return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[9999] flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-black/40 backdrop-blur-lg p-8 rounded-2xl border border-[#BE185D]/20 max-w-md w-full mx-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center bg-clip-text text-transparent bg-gradient-to-r from-[#BE185D] to-white",children:"Welcome to HR Interview"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&l.trim()&&n.trim()&&t({registerNumber:r,name:l,sessionId:n})},className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"sessionId",className:"block text-sm font-medium text-gray-300 mb-2",children:"Session ID"}),(0,s.jsx)("input",{type:"text",id:"sessionId",value:n,onChange:e=>i(e.target.value),className:"w-full px-4 py-3 bg-black/50 border border-[#BE185D]/20 rounded-lg focus:outline-none focus:border-[#BE185D] transition-colors text-white",required:!0,placeholder:"Enter your session ID"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"registerNumber",className:"block text-sm font-medium text-gray-300 mb-2",children:"Register Number"}),(0,s.jsx)("input",{type:"text",id:"registerNumber",value:r,onChange:e=>a(e.target.value),className:"w-full px-4 py-3 bg-black/50 border border-[#BE185D]/20 rounded-lg focus:outline-none focus:border-[#BE185D] transition-colors text-white",required:!0,placeholder:"Enter your register number"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-300 mb-2",children:"Full Name"}),(0,s.jsx)("input",{type:"text",id:"name",value:l,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 bg-black/50 border border-[#BE185D]/20 rounded-lg focus:outline-none focus:border-[#BE185D] transition-colors text-white",required:!0,placeholder:"Enter your full name"})]}),(0,s.jsx)("button",{type:"submit",className:"w-full px-6 py-3 bg-gradient-to-r from-[#BE185D] to-[#BE185D]/80 text-white rounded-lg hover:shadow-[0_0_30px_-5px_#BE185D] transition-all duration-300",children:"Start Interview"})]})]})})},q=e=>{let{children:t,title:r,className:a,childrenClassName:l,padding:o=!0,backgroundColor:n="transparent"}=e;return(0,s.jsxs)("div",{className:"flex flex-col border rounded-sm border-gray-800 text-gray-500 bg-".concat(n," ").concat(a),children:[r&&(0,s.jsx)("div",{className:"flex items-center justify-center text-xs uppercase py-2 border-b border-b-gray-800 tracking-wider",style:{height:"".concat(32,"px")},children:(0,s.jsx)("h2",{children:r})}),(0,s.jsx)("div",{className:"flex flex-col items-center grow w-full ".concat(l),style:{height:"calc(100% - ".concat(r?"32px":"0px",")"),padding:"".concat(4*(o?4:0),"px")},children:t})]})},W=e=>{let{name:t,message:r,accentColor:a,isSelf:l,hideName:o}=e;return(0,s.jsxs)("div",{className:"flex flex-col gap-1 ".concat(o?"pt-0":"pt-6"),children:[!o&&(0,s.jsx)("div",{className:"text-".concat(l?"gray-700":a+"-800 text-ts-"+a," uppercase text-xs"),children:t}),(0,s.jsx)("div",{className:"pr-4 text-".concat(l?"gray-300":a+"-500"," text-sm ").concat(l?"":"drop-shadow-"+a," whitespace-pre-line"),children:r})]})},Q=e=>{let{messages:t,accentColor:r,onSend:a}=e,l=(0,d.useRef)(null);return(0,d.useEffect)(()=>{l.current&&(l.current.scrollTop=l.current.scrollHeight)},[l,t]),(0,s.jsx)("div",{className:"flex flex-col gap-4 w-full h-full",children:(0,s.jsx)("div",{ref:l,className:"overflow-y-auto",style:{height:"calc(100% - ".concat(48,"px)")},children:(0,s.jsx)("div",{className:"flex flex-col min-h-full justify-end",children:t.map((e,t,a)=>{let l=t>=1&&a[t-1].name===e.name;return(0,s.jsx)(W,{hideName:l,name:e.name,message:e.message,isSelf:e.isSelf,accentColor:r},t)})})})})};function Y(e){let{agentAudioTrack:t,accentColor:r,onTranscriptionUpdate:a}=e,l=(0,k.U)(t),o=(0,k.C)(),n=(0,k.U)({publication:o.microphoneTrack,source:x.fQ.Source.Microphone,participant:o.localParticipant}),[i,c]=(0,d.useState)(new Map),[m,u]=(0,d.useState)([]),{chatMessages:g,send:p}=(0,k.w)();return(0,d.useEffect)(()=>{let e=new Map(i);l.segments.forEach(r=>e.set(r.id,Z(r,e.get(r.id),t.participant))),n.segments.forEach(t=>e.set(t.id,Z(t,e.get(t.id),o.localParticipant)));let r=Array.from(e.values());for(let e of g){var s,d,m,p;let a=(null===(s=e.from)||void 0===s?void 0:s.identity)===(null===(d=t.participant)||void 0===d?void 0:d.identity),l=(null===(m=e.from)||void 0===m?void 0:m.identity)===o.localParticipant.identity,n=null===(p=e.from)||void 0===p?void 0:p.name;n||(n=a?"HR":l?"You":"Unknown"),r.push({name:n,message:e.message,timestamp:e.timestamp,isSelf:l})}r.sort((e,t)=>e.timestamp-t.timestamp),u(r),c(e),a&&a(r)},[i,l.segments,n.segments,g,o.localParticipant,t.participant,a]),(0,s.jsx)(Q,{messages:m,accentColor:r,onSend:p})}function Z(e,t,r){var s;return{message:e.final?e.text:"".concat(e.text," ..."),name:r instanceof x.Ix?"You":"HR",isSelf:r instanceof x.Ix,timestamp:null!==(s=null==t?void 0:t.timestamp)&&void 0!==s?s:Date.now()}}var K=r(1508);let G=(0,d.createContext)(void 0),$=e=>{let{children:t}=e,[r,a]=(0,d.useState)(null);return(0,s.jsx)(G.Provider,{value:{toastMessage:r,setToastMessage:a},children:t})},X=()=>{let e=d.useContext(G);if(void 0===e)throw Error("useToast must be used within a ToastProvider");return e},ee=e=>({"Fullstack developer":"001",DevOps:"002","Frontend developer":"003","Backend developer":"004","Software Engineer":"005","Data Engineer":"006","Machine Learning Engineer":"007","Cloud Engineer":"008","System Administrator":"009","QA Engineer":"010","Electronics Engineer":"011","Electrical Engineer":"012","Mechanical Engineer":"013","Civil Engineer":"014","Product Manager":"015","Project Manager":"016","UI/UX Designer":"017","Database Administrator":"018","Security Engineer":"019","Network Engineer":"020"})[e]||"999";function et(e){let{logo:t,themeColors:r,onConnect:a,timeLeft:o=0}=e,[n,i]=(0,d.useState)(null),[c,m]=(0,d.useState)(!0),[g,f]=(0,d.useState)([]),[b,v]=(0,d.useState)(""),[y,N]=(0,d.useState)(!1),[S,I]=(0,d.useState)(0),[_,R]=(0,d.useState)(null),[D,T]=(0,d.useState)([]),[P,M]=(0,d.useState)(""),{config:L,setUserSettings:O}=A(),{setToastMessage:F}=X(),{name:B}=(0,k.v)(),{localParticipant:U}=(0,k.C)(),H=(0,k.a)(),z=(0,k.t)(),W=z.filter(e=>{let{participant:t}=e;return t instanceof x.Ix}),Q=W.find(e=>{let{source:t}=e;return t===x.fQ.Source.Camera}),Z=W.find(e=>{let{source:t}=e;return t===x.fQ.Source.Microphone}),[G,$]=(0,d.useState)(null),et=(0,d.useCallback)(()=>{G&&(G.getTracks().forEach(e=>e.stop()),$(null))},[G]);(0,d.useEffect)(()=>()=>{et()},[et]),(0,d.useCallback)(e=>{let t={name:"System",message:e,timestamp:new Date().getTime(),isSelf:!1};console.log("Adding system note:",t),f(e=>{let r=[...e,t];return console.log("Updated transcripts:",r),localStorage.setItem("transcriptions",JSON.stringify(r)),r})},[]);let er=(0,d.useCallback)(e=>{n&&(M(ee(e)),a(!0))},[n,a]);(0,d.useEffect)(()=>{m(!0)},[]);let es=(0,d.useCallback)(()=>{if(b&&n){let e="".concat(n.registerNumber,"_").concat(n.name.replace(/\s+/g,"_"),"_Interview_Feedback.txt"),t=new Blob([b],{type:"text/plain"}),r=window.URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(r),document.body.removeChild(s)}},[b,n]),ea=(0,k.V)();(0,d.useCallback)(e=>{if("transcription"===e.topic){let t=JSON.parse(new TextDecoder("utf-8").decode(e.payload)),r=new Date().getTime();"timestamp"in t&&t.timestamp>0&&(r=t.timestamp),_&&(T(e=>{let t=[...e];if(_){var s;t.push({aiMessage:(null===(s=g[g.length-1])||void 0===s?void 0:s.message)||"",responseTime:(r-_)/1e3})}return t}),R(null));let s={name:"You",message:t.text,timestamp:r,isSelf:!0};f(e=>{let t=[...e,s];return localStorage.setItem("transcriptions",JSON.stringify(t)),localStorage.setItem("responseTimes",JSON.stringify(D)),t})}},[_,g,D]),(0,d.useEffect)(()=>{if(g.length>0){let e=g[g.length-1];"HR Assistant"!==e.name||e.isSelf||R(e.timestamp)}},[g]);let el=(0,d.useCallback)(async e=>{if(n)try{var t,r;let s=(0,u.iH)(p,"interview_feedback/".concat(n.registerNumber.replace(/[.#$[\]]/g,"_"))),a={sessionId:n.sessionId,registerNumber:n.registerNumber,name:n.name,feedback:e,timestamp:new Date().toISOString(),stars:(null===(r=e.match(/★+½?(?=☆|$)/))||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.length)||0,interviewDate:new Date().toLocaleDateString(),interviewTime:new Date().toLocaleTimeString()};await (0,u.t8)(s,a),console.log("Feedback saved to Firebase:",a),F({message:"Interview feedback saved successfully!",type:"success"})}catch(e){console.error("Error saving feedback to Firebase:",e),F({message:"Failed to save interview feedback",type:"error"})}},[n]);(0,d.useCallback)(async()=>{console.log("Starting summarization...");let e=localStorage.getItem("transcriptions"),t=localStorage.getItem("responseTimes"),r=e?JSON.parse(e):g,s=t?JSON.parse(t):D,a=r.find(e=>"HR Assistant"===e.name&&e.message.includes("Dress Code Assessment:"));if(console.log("All transcripts for summarization:",r),console.log("Response times:",s),console.log("Dress code note:",a),!r||!(r.length>0))return console.log("No transcripts available for summarization"),null;try{N(!0);let e=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcriptions:r,responseTimes:s,dressCode:{note:(null==a?void 0:a.message)||"Candidate was in formal attire",wasInformal:null==a?void 0:a.message.includes("informal attire"),standards:{male:["formal shirt","business shirt","dress shirt"],female:["churidar","kurti","chudithar","formal suit","saree","salwar"]},weightage:{min:7,max:9}}})});console.log("Got response from API:",e);let t=await e.json();return console.log("Summary data:",t),t.summary&&(console.log("Setting summary in state and localStorage"),v(t.summary),localStorage.setItem("interviewSummary",t.summary),await el(t.summary),F({message:"HR Interview Feedback Generated! Check the summary below.",type:"success"})),t.summary}catch(e){return console.error("Error in summarization:",e),F({message:"Failed to generate interview feedback",type:"error"}),null}finally{N(!1)}},[g,F,el]);let eo=(0,d.useCallback)(()=>{H===x.em.Connected?a(!1):a(!0)},[H,a]);(0,d.useEffect)(()=>{H===x.em.Connected?(U.setCameraEnabled(!0),U.setMicrophoneEnabled(L.settings.inputs.mic)):H===x.em.Disconnected&&setTimeout(()=>{localStorage.removeItem("transcriptions")},1e3)},[L,U,H]),(0,d.useEffect)(()=>{let e=async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0}),U&&(await U.setCameraEnabled(!0),console.log("Camera enabled on mount"))}catch(e){console.error("Error enabling camera on mount:",e)}};U&&e()},[U]),(0,d.useEffect)(()=>{g.length>0&&localStorage.setItem("transcriptions",JSON.stringify(g))},[g]),(0,d.useEffect)(()=>{let e=localStorage.getItem("transcriptions");if(e)try{let t=JSON.parse(e);Array.isArray(t)&&f(t)}catch(e){console.error("Error parsing saved transcripts:",e)}},[]),(0,d.useEffect)(()=>()=>{localStorage.removeItem("transcriptions"),localStorage.removeItem("interviewSummary")},[]);let en=z.find(e=>e.publication.kind===x.fQ.Kind.Video&&e.participant.isAgent);(0,d.useMemo)(()=>{let e="object-".concat(L.video_fit||"cover"),t=(0,s.jsx)("div",{className:"flex items-center justify-center text-gray-700 text-center w-full h-full",children:"No video track. Connect to get started."}),r=(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2 text-gray-700 text-center h-full w-full",children:[(0,s.jsx)(h,{}),"Waiting for video track"]}),a=(0,s.jsx)(l.V,{trackRef:en,className:"absolute top-1/2 -translate-y-1/2 ".concat(e," object-position-center w-full h-full")}),o=null;return o=H===x.em.Disconnected?t:en?a:r,(0,s.jsx)("div",{className:"flex flex-col w-full grow text-gray-950 bg-black rounded-sm border border-gray-800 relative",children:o})},[en,L.video_fit,H]),(0,d.useEffect)(()=>{document.body.style.setProperty("--lk-theme-color",L.settings.theme_color),document.body.style.setProperty("--lk-drop-shadow","".concat(L.settings.theme_color," 0px 0px 18px"))},[L.settings.theme_color]);let ei=(0,d.useMemo)(()=>{let e=(0,s.jsx)("div",{className:"flex flex-col items-center justify-center gap-2 text-gray-700 text-center w-full",children:"No audio track. Connect to get started."}),t=(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2 text-gray-700 text-center w-full",children:[(0,s.jsx)(h,{}),"Waiting for audio track"]}),r=(0,s.jsx)("div",{className:"flex items-center justify-center w-full h-48 [--lk-va-bar-width:30px] [--lk-va-bar-gap:20px] [--lk-fg:var(--lk-theme-color)]",children:(0,s.jsx)(l.B,{state:ea.state,trackRef:ea.audioTrack,barCount:5,options:{minHeight:20}})});return H===x.em.Disconnected?e:ea.audioTrack?r:t},[ea.audioTrack,H,ea.state]),ec=(0,d.useMemo)(()=>ea.audioTrack?(0,s.jsx)(Y,{agentAudioTrack:ea.audioTrack,accentColor:L.settings.theme_color,onTranscriptionUpdate:e=>{f(e),localStorage.setItem("transcriptions",JSON.stringify(e)),console.log("Updated transcripts from TranscriptionTile:",e)}}):(0,s.jsx)(s.Fragment,{}),[L.settings.theme_color,ea.audioTrack]),ed=(0,d.useMemo)(()=>H===x.em.Disconnected?P?(0,s.jsx)("div",{className:"flex flex-col gap-4 p-4",children:(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-white text-sm",children:'Top right section tap on "select role" to select your room number'}),(0,s.jsx)("select",{className:"w-full px-3 py-2 bg-gray-800 text-white rounded border border-gray-700 focus:outline-none focus:border-[#BE185D]",onChange:e=>er(e.target.value),defaultValue:""})]})}):(0,s.jsx)("div",{className:"flex flex-col items-center justify-center h-full w-full text-center p-4",children:(0,s.jsx)("p",{className:"text-gray-500",children:"Please select a role from the top right dropdown to begin."})}):(0,s.jsxs)("div",{className:"flex flex-col gap-4 h-full w-full items-start overflow-y-auto",children:[L.description&&(0,s.jsx)(C,{title:"Description",children:L.description}),(0,s.jsx)(C,{title:"Settings",children:U&&(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)(E,{name:"Room",value:B,valueColor:L.settings.theme_color}),(0,s.jsx)(E,{name:"Participant",value:U.identity})]})}),(0,s.jsx)(C,{title:"Status",children:(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)(E,{name:"Room connected",value:H===x.em.Connecting?(0,s.jsx)(h,{diameter:16,strokeWidth:2}):H.toUpperCase(),valueColor:H===x.em.Connected?L.settings.theme_color:"#6B7280"}),(0,s.jsx)(E,{name:"Agent connected",value:ea.agent?"TRUE":H===x.em.Connected?(0,s.jsx)(h,{diameter:12,strokeWidth:2}):"FALSE",valueColor:ea.agent?L.settings.theme_color:"#6B7280"})]})}),Q&&(0,s.jsx)(C,{title:"Camera",deviceSelectorKind:"videoinput",children:(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(l.V,{className:"rounded-sm border border-gray-800 opacity-70 w-full",trackRef:Q})})}),Z&&(0,s.jsx)(C,{title:"Microphone",deviceSelectorKind:"audioinput",children:(0,s.jsx)(j,{trackRef:Z})}),(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(C,{title:"Color",children:(0,s.jsx)(w,{colors:r,selectedColor:L.settings.theme_color,onSelect:e=>{let t={...L.settings};t.theme_color=e,O(t)}})})}),L.show_qr&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(C,{title:"QR Code",children:(0,s.jsx)(K.tv,{value:window.location.href,width:"128"})})})]}),[L.description,L.settings,L.show_qr,U,B,H,Q,Z,r,O,ea.agent]);(0,d.useCallback)(()=>{navigator.clipboard.writeText(window.location.href),F({message:"Link copied to clipboard!",type:"success"})},[F]),(0,d.useCallback)(()=>{T(e=>[...D,...e])},[D]);let em=(0,d.useMemo)(()=>[{title:"Interview",content:(0,s.jsx)(q,{title:"Interview Session",className:"w-full h-full grow",childrenClassName:"justify-center",children:(0,s.jsx)("div",{className:"p-4 text-white",children:(0,s.jsx)("p",{className:"text-sm",children:"Interview session in progress..."})})})}],[]);return(0,d.useEffect)(()=>{if(b){let e={title:"Summary",content:(0,s.jsx)(q,{title:"HR Interview Feedback",className:"w-full h-full grow",childrenClassName:"justify-center",children:(0,s.jsx)("div",{className:"p-4 text-white",children:(0,s.jsx)("p",{className:"text-sm whitespace-pre-line",children:b})})})},t=em.findIndex(e=>"Summary"===e.title);-1===t?em.push(e):em[t]=e}},[b,em]),(0,d.useEffect)(()=>{let e;return y&&(I(0),e=setInterval(()=>{I(e=>e+1)},1e3)),()=>{e&&clearInterval(e)}},[y]),(0,d.useEffect)(()=>{let e;return H===x.em.Connected&&(e=setTimeout(()=>{console.log("Auto-disconnecting after 10 minutes"),eo()},6e5)),()=>{e&&clearTimeout(e)}},[H,eo]),(0,s.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,s.jsx)(J,{title:L.title,logo:t,githubLink:L.github_link,height:56,accentColor:L.settings.theme_color,connectionState:H,onConnectClicked:eo,timeLeft:o}),c?(0,s.jsx)(V,{onSubmit:e=>{i(e),m(!1)}}):(0,s.jsxs)("div",{className:"flex gap-4 py-4 grow w-full min-h-[calc(100vh-120px)]",children:[(0,s.jsx)("div",{className:"flex flex-col basis-1/3 min-h-full",children:(0,s.jsx)(q,{title:"Audio",className:"w-full h-full",childrenClassName:"justify-center",children:ei})}),(0,s.jsx)("div",{className:"flex flex-col basis-1/3 min-h-full",children:(0,s.jsx)(q,{title:"Chat",className:"w-full h-full",childrenClassName:"justify-start",children:ec})}),(0,s.jsx)("div",{className:"flex flex-col basis-1/3 min-h-full",children:(0,s.jsx)(q,{title:"Settings",className:"w-full h-full",childrenClassName:"justify-start",children:ed})})]}),b&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[9999] flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-gray-900 p-6 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-white",children:"HR Interview Feedback"}),(0,s.jsx)("button",{onClick:()=>v(""),className:"text-gray-400 hover:text-white",children:"✕"})]}),(0,s.jsx)("div",{className:"text-white whitespace-pre-line",children:b}),(0,s.jsx)("div",{className:"mt-4 flex justify-end",children:(0,s.jsx)("button",{onClick:es,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Download Feedback"})})]})}),y&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[9999] flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-gray-900 p-8 rounded-lg shadow-xl text-center",children:[(0,s.jsx)(h,{diameter:48,strokeWidth:4}),(0,s.jsx)("p",{className:"text-white mt-4 text-lg font-semibold",children:"Analyzing Interview Performance..."}),(0,s.jsx)("p",{className:"text-gray-400 mt-2",children:"Please wait while we evaluate your interview"}),(0,s.jsxs)("p",{className:"text-gray-500 mt-2",children:["Time elapsed: ","".concat(Math.floor(S/60),":").concat((S%60).toString().padStart(2,"0"))]})]})})]})}let er=()=>{let{toastMessage:e,setToastMessage:t}=X(),r=(null==e?void 0:e.type)==="error"?"red":(null==e?void 0:e.type)==="success"?"green":"amber";return(0,s.jsxs)("div",{className:"absolute text-sm break-words px-4 pr-12 py-2 bg-".concat(r,"-950 rounded-sm border border-").concat(r,"-800 text-").concat(r,"-400 top-4 left-4 right-4"),children:[(0,s.jsx)("button",{className:"absolute right-2 border border-transparent rounded-md px-2 hover:bg-".concat(r,"-900 hover:text-").concat(r,"-300"),onClick:()=>{t(null)},children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z",fill:"currentColor"})})}),null==e?void 0:e.message]})};var es=r(7204);let ea=(0,d.createContext)(void 0),el=e=>{let{children:t}=e,{generateToken:r,wsUrl:a}=(0,es.B)(),{setToastMessage:l}=X(),{config:o}=A(),[n,i]=(0,d.useState)({wsUrl:"",token:"",shouldConnect:!1,mode:"manual"}),c=(0,d.useCallback)(async e=>{let t="",s="",n=localStorage.getItem("interviewRole");if(!n||!["fullstack","devops","frontend","backend","software","data","ml","cloud","sysadmin","qa","electronics","electrical","mechanical","civil","product","project","uiux","dba","security","network"].includes(n)){l({type:"error",message:"Please select a valid room before connecting."});return}try{if("cloud"===e){try{t=await r()}catch(e){l({type:"error",message:"Failed to generate token, you may need to increase your role in this LiveKit Cloud project."});return}s=a}else if("env"===e){s="wss://ai-voice-6bu2rba9.livekit.cloud";let e=await fetch("/api/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:n})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to get access token")}let r=await e.json();if(!r.accessToken)throw Error("No access token in response");t=r.accessToken}else t=o.settings.token,s=o.settings.ws_url;i({wsUrl:s,token:t,shouldConnect:!0,mode:e})}catch(e){throw console.error("Error getting token:",e),l({type:"error",message:e instanceof Error?e.message:"Failed to get access token. Please try again."}),e}},[a,o.settings.token,o.settings.ws_url,r,l]),m=(0,d.useCallback)(async()=>{i(e=>({...e,shouldConnect:!1}))},[]);return(0,s.jsx)(ea.Provider,{value:{wsUrl:n.wsUrl,token:n.token,shouldConnect:n.shouldConnect,mode:n.mode,connect:c,disconnect:m},children:t})},eo=()=>{let e=d.useContext(ea);if(void 0===e)throw Error("useConnection must be used within a ConnectionProvider");return e},en=["#BE185D"];function ei(){return(0,s.jsx)($,{children:(0,s.jsx)(F,{children:(0,s.jsx)(el,{children:(0,s.jsx)(ed,{})})})})}let ec=(e,t,r)=>{var s;let a=(null===(s=e.match(/★+½?(?=☆|$)/))||void 0===s?void 0:s[0])||"";return Math.round(((a.match(/★/g)||[]).length+(a.includes("\xbd")?.5:0))/5*60+.2*Math.min(100,10*t)+.2*Math.min(100,r/5))};function ed(){let e=(0,m.useRouter)(),{shouldConnect:t,wsUrl:r,token:i,mode:g,connect:f,disconnect:b}=eo(),{config:v}=A(),{toastMessage:w,setToastMessage:j}=X(),[k,N]=(0,d.useState)(x.em.Disconnected);(0,d.useEffect)(()=>{let t;let r=localStorage.getItem("validatedFromLanding"),s=localStorage.getItem("validationTimestamp"),a=localStorage.getItem("userInfo"),l=localStorage.getItem("sessionId"),o=Date.now();if(!r||!s||!a||!l||o-parseInt(s)>3e5){localStorage.removeItem("validatedFromLanding"),localStorage.removeItem("validationTimestamp"),localStorage.removeItem("userInfo"),localStorage.removeItem("sessionId"),localStorage.removeItem("sessionTimeLeft"),localStorage.removeItem("sessionStartTime"),localStorage.removeItem("transcriptions"),e.push("/landing");return}try{t=JSON.parse(a)}catch(t){console.error("Failed to parse user info:",t),localStorage.clear(),e.push("/landing");return}if(!t||"object"!=typeof t||!t.registerNumber||!t.name||!t.email){console.error("Invalid user info structure:",t),localStorage.clear(),e.push("/landing");return}},[e]);let[S,C]=(0,d.useState)(900),[E,I]=(0,d.useState)(!1),[_,R]=(0,d.useState)(""),[D,T]=(0,d.useState)(!1),[P,M]=(0,d.useState)(!1);(0,d.useEffect)(()=>{t?N(x.em.Connected):N(x.em.Disconnected)},[t]),(0,d.useEffect)(()=>{I(!0);{let e=localStorage.getItem("sessionTimeLeft"),t=localStorage.getItem("sessionStartTime");if(e&&t){let r=Math.floor((Date.now()-parseInt(t))/1e3);C(Math.max(0,parseInt(e)-r))}else localStorage.setItem("sessionStartTime",Date.now().toString()),localStorage.setItem("sessionTimeLeft","900")}},[]);let L=(0,d.useCallback)(async()=>{let t;console.log("Starting feedback generation...");let r=localStorage.getItem("userInfo"),s=localStorage.getItem("sessionId");if(!r||!s){console.error("Missing user info or session ID",{userInfo:!!r,sessionId:!!s}),j({message:"Session information not found. Please try again.",type:"error"});return}let a=localStorage.getItem("transcriptions");if(!a){console.log("No transcriptions found"),j({message:"No interview responses found. Please try again.",type:"error"});return}try{if(!(t=JSON.parse(a))||0===t.length){console.log("No valid transcriptions to process"),j({message:"No valid interview responses found. Please try again.",type:"error"});return}}catch(e){console.error("Error parsing transcriptions:",e),j({message:"Failed to process interview responses. Please try again.",type:"error"});return}try{var l,o;T(!0);let a=await fetch("/api/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcriptions:t})});if(!a.ok)throw Error("Server error: ".concat(a.status," ").concat(a.statusText));if(!a.body)throw Error("No response body received");let n=a.body.getReader(),i=new TextDecoder,c="";for(;;){let{done:e,value:t}=await n.read();if(e)break;for(let e of i.decode(t).split("\n").filter(Boolean))try{let t=JSON.parse(e);if("error"===t.type)throw Error(t.error||"Unknown error occurred");"chunk"===t.type?c+=t.content:"complete"===t.type&&(c=t.summary)}catch(e){console.error("Error parsing stream chunk:",e)}}if(!c||""===c.trim())throw Error("No valid feedback generated");let d=JSON.parse(r),m=ec(c,t.length,t.reduce((e,t)=>e+(t.message?t.message.split(" ").length:0),0)),g={sessionId:s,registerNumber:d.registerNumber,name:d.name,feedback:c,timestamp:new Date().toISOString(),stars:(null===(o=c.match(/★+½?(?=☆|$)/))||void 0===o?void 0:null===(l=o[0])||void 0===l?void 0:l.length)||0,performancePercentage:m,interviewDate:new Date().toLocaleDateString(),interviewTime:new Date().toLocaleTimeString(),transcriptionCount:t.length,totalWords:t.reduce((e,t)=>e+(t.message?t.message.split(" ").length:0),0)},h=(0,u.iH)(p,"sessions/".concat(s)),x=(0,u.iH)(p,"interview_feedback/".concat(d.registerNumber.replace(/[.#$[\]]/g,"_"),"/").concat(s));await Promise.all([(0,u.t8)(h,g),(0,u.t8)(x,g)]),console.log("Feedback saved to Firebase successfully:",g),M(!0),e.push("/interview-complete")}catch(e){console.error("Error in feedback generation:",e),j({message:e instanceof Error?e.message:"An error occurred while generating feedback. Please try again.",type:"error"})}finally{T(!1)}},[j,e,T,M]);(0,d.useEffect)(()=>{if(!E)return;let t=setInterval(()=>{C(r=>{let s=r-1;if(localStorage.setItem("sessionTimeLeft",s.toString()),120===s&&!P){console.log("Checking session data before feedback generation...");let e=localStorage.getItem("userInfo"),t=localStorage.getItem("sessionId");if(!e||!t)return console.error("Missing session data at feedback time",{userInfo:!!e,sessionId:!!t}),j({message:"Session data not found. Please refresh and try again.",type:"error"}),s;console.log("Triggering feedback generation at 2 minutes remaining"),b(),L()}return s<=1?(clearInterval(t),localStorage.removeItem("sessionTimeLeft"),localStorage.removeItem("sessionStartTime"),P||e.push("/landing"),0):s})},1e3);return()=>{clearInterval(t)}},[e,b,E,P,L,j]);let O=(0,d.useCallback)(async(e,t)=>{e?f(t):b()},[f,b]),F=(0,d.useMemo)(()=>!0,[r]);return(0,d.useEffect)(()=>{document.documentElement.style.setProperty("--theme-color",v.settings.theme_color),document.documentElement.style.setProperty("--theme-hover","".concat(v.settings.theme_color,"1A")),document.documentElement.style.setProperty("--theme-border","".concat(v.settings.theme_color,"33")),document.documentElement.style.setProperty("--theme-shadow","".concat(v.settings.theme_color,"4D")),document.documentElement.style.setProperty("--lk-theme-color",v.settings.theme_color)},[v.settings.theme_color]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c(),{children:[(0,s.jsx)("title",{children:v.title}),(0,s.jsx)("meta",{name:"description",content:v.description}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black"}),(0,s.jsx)("meta",{property:"og:image",content:"https://livekit.io/images/og/agents-playground.png"}),(0,s.jsx)("meta",{property:"og:image:width",content:"1200"}),(0,s.jsx)("meta",{property:"og:image:height",content:"630"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,s.jsxs)("main",{className:"relative flex flex-col justify-center px-4 items-center h-full w-full bg-black",children:[(0,s.jsxs)("div",{className:"fixed bottom-4 left-4 text-white bg-gray-900 px-3 py-1 rounded-md shadow-lg z-50",children:["Session expires in: ","".concat(Math.floor(S/60),":").concat((S%60).toString().padStart(2,"0"))]}),D&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[9999] flex items-center justify-center",children:(0,s.jsx)("div",{className:"bg-gray-900 p-8 rounded-lg shadow-xl text-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(h,{diameter:48,strokeWidth:4}),(0,s.jsx)("p",{className:"text-white mt-4 text-lg font-semibold",children:"Evaluating Your Performance..."}),(0,s.jsx)("p",{className:"text-gray-400 mt-2",children:"Please wait while we analyze your interview responses"}),(0,s.jsx)("p",{className:"text-gray-500 mt-2",children:"This may take a few moments"})]})})}),(0,s.jsx)(o.M,{children:w&&(0,s.jsx)(n.E.div,{className:"left-0 right-0 top-0 absolute z-10",initial:{opacity:0,translateY:-50},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:-50},children:(0,s.jsx)(er,{})})}),F?(0,s.jsxs)(a.L,{className:"flex flex-col h-full w-full",serverUrl:r,token:i,connect:t,onError:e=>{j({message:e.message,type:"error"}),console.error(e)},children:[(0,s.jsx)(et,{themeColors:en,onConnect:e=>{O(e,"env")},timeLeft:S}),(0,s.jsx)(l.R,{}),(0,s.jsx)(l.q,{label:"Click to enable audio playback"})]}):(0,s.jsx)(y,{accentColor:en[0],onConnectClicked:e=>{O(!0,e)}})]})]})}}},function(e){e.O(0,[627,970,353,984,210,888,774,179],function(){return e(e.s=1185)}),_N_E=e.O()}]);